---
page_title: "gamefabric_branch Resource - GameFabric"
subcategory: ""
description: |-
  
---

# gamefabric_branch (Resource)

GameFabric runs its own internal Container registry proxy, which is where you should push your game server images to in order to have them available in game servers.
Those images are scoped by branch. For example, a standard use case would be to have a development branch and a production branch.
The development branch would contain dev images to be used by a development Armada,
while the production branch would only contain releases of the game server that make it to production.

For details check the <a href="https://docs.gamefabric.com/multiplayer-servers/getting-started/glossary#branch">GameFabric documentation</a>.

## Retention Policies

Retention policy rules control the lifecycle of container images and tags within a branch. They automatically clean up old images while preserving important releases.

### How Retention Policies Work

- **Multiple Rules**: You can define multiple retention policy rules, each targeting different image or tag patterns
- **Rule Logic**: Each rule uses regular expressions to match specific images and tags
- **Keep Conditions**: Rules support both `keep_count` (minimum number of tags to retain) and `keep_days` (minimum age before deletion)  
- **Union Logic**: When both `keep_count` and `keep_days` are specified, tags are retained if they meet **either** condition
- **Per-Image Basis**: Retention counts apply per image name, not globally across the branch
- **Deployment Protection**: Images/tags that are currently deployed will **never** be deleted, regardless of retention policy rules. Only unused images are eligible for deletion.

### Retention Rule Parameters

- `name` (Required): A descriptive name for the retention rule
- `image_regex` (Optional): Regular expression to match image names. Defaults to `".*"` (all images)
- `tag_regex` (Optional): Regular expression to match tag names. Defaults to `".*"` (all tags)
- `keep_count` (Optional): Minimum number of matching tags to retain per image
- `keep_days` (Optional): Minimum number of days to keep matching tags

### Common Retention Patterns

**Production Releases**: Keep semantic version tags (v1.0.0, v2.1.3) longer.
```hcl
{
  name        = "keep-releases"
  tag_regex   = "^v[0-9]+\\.[0-9]+\\.[0-9]+$"
  keep_count  = 10
  keep_days   = 30
}
```

**Development Builds**: Keep fewer development/snapshot builds
```hcl
{
  name        = "cleanup-snapshots"
  tag_regex   = "^snapshot-.*"
  keep_count  = 5
  keep_days   = 14
}
```

**PR Builds**: Aggressively clean up temporary pull request or feature builds
```hcl
{
  name        = "cleanup-pr-builds"
  tag_regex   = "^pr-[0-9]+-.*"
  keep_count  = 3
  keep_days   = 1
}
```

## Example Usage

### Production Branch
```terraform
resource "gamefabric_branch" "prod" {
  name         = "prod"
  display_name = "Production Branch"
  description  = "Production branch for stable releases"

  labels = {
    environment = "production"
  }
  retention_policy_rules = [
    {
      name        = "keep-latest-releases" # Required: Name of the retention policy rule.
      image_regex = ".*"                   # Optional: Regex to match image names. Empty or ".*" matches all.
      tag_regex   = ".*"                   # Optional: Regex to match tag names (e.g., semantic versions).
      keep_count  = 10                     # Optional: Minimum number of matching tags to retain per image.
      keep_days   = 14                     # Optional: Minimum number of days to keep matching tags.
    },
  ]
}
```

### Development Branch
```terraform
resource "gamefabric_branch" "feature" {
  name         = "feature"
  display_name = "Feature Branch"
  description  = "Feature development branch with image retention policies"

  labels = {
    environment = "development"
  }

  # Define retention policy rules for managing image lifecycle.
  # Multiple rules can be specified to handle different image patterns.
  retention_policy_rules = [
    {
      name        = "keep-latest-releases" # Required: Name of the retention policy rule.
      image_regex = ".*"                   # Optional: Regex to match image names. Empty or ".*" matches all.
      tag_regex   = ".*"                   # Optional: Regex to match tag names (e.g., semantic versions).
      keep_count  = 5                      # Optional: Minimum number of matching tags to retain per image.
      keep_days   = 1                      # Optional: Minimum number of days to keep matching tags.
    },
  ]
}
```


<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `retention_policy_rules` (Attributes List) RetentionPolicyRules are the rules that define how images are retained. (see [below for nested schema](#nestedatt--retention_policy_rules))

### Optional

- `annotations` (Map of String) Annotations is an unstructured map of keys and values stored on an object.
- `description` (String) Description is the optional description of the branch.
- `display_name` (String) DisplayName is the display name of the branch.
- `labels` (Map of String) A map of keys and values that can be used to organize and categorize objects.
- `name` (String) The unique object name within its scope. Must contain only lowercase alphanumeric characters, hyphens, or dots. Must start and end with an alphanumeric character. Maximum length is 63 characters.

### Read-Only

- `id` (String) The unique Terraform identifier.

<a id="nestedatt--retention_policy_rules"></a>
### Nested Schema for `retention_policy_rules`

Required:

- `name` (String) Name is the name of the image retention policy.

Optional:

- `image_regex` (String) ImageRegex is the optional regex selector for images that this policy applies to.
- `keep_count` (Number) KeepCount is the minimum number of tags to keep per image.
- `keep_days` (Number) KeepDays is the minimum number of days an image tag must be kept for.
- `tag_regex` (String) TagRegex is the optional regex selector for tags that this policy applies to.

## Import

Import is supported using the following syntax:

In Terraform v1.5.0 and later, the [`import` block](https://developer.hashicorp.com/terraform/language/import) can be used with the `id` attribute, for example:

```terraform
import {
  id = "{{name}}"
  to = gamefabric_branch.main
}
```

The [`terraform import` command](https://developer.hashicorp.com/terraform/cli/commands/import) can be used, for example:

```shell
terraform import gamefabric_branch.main "{{ name }}"
```